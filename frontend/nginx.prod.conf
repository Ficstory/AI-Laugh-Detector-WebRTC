# =============================================================================
# Nginx Production Configuration (Frontend SPA)
# =============================================================================
#
# ğŸ“‹ ê°œìš”:
#   - React/Vue SPA ì •ì  íŒŒì¼ ì„œë¹™
#   - try_filesë¡œ í´ë¼ì´ì–¸íŠ¸ ë¼ìš°íŒ… ì§€ì›
#   - Gzip ì••ì¶• í™œì„±í™”
#
# =============================================================================

server {
    listen 80;
    server_name _;
    
    # -----------------------------------------------------------------------
    # ë£¨íŠ¸ ë””ë ‰í† ë¦¬
    # -----------------------------------------------------------------------
    root /usr/share/nginx/html;
    index index.html;
    
    # -----------------------------------------------------------------------
    # Gzip ì••ì¶•
    # -----------------------------------------------------------------------
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript 
               application/javascript application/json application/xml
               application/wasm application/octet-stream;
    
    # -----------------------------------------------------------------------
    # MIME types ì„¤ì •
    # -----------------------------------------------------------------------
    include /etc/nginx/mime.types;
    
    # -----------------------------------------------------------------------
    # SPA ë¼ìš°íŒ… ì§€ì›
    # -----------------------------------------------------------------------
    # ëª¨ë“  ê²½ë¡œë¥¼ index.htmlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (í´ë¼ì´ì–¸íŠ¸ ë¼ìš°íŒ…)
    # ì‹¤ì œ íŒŒì¼ì´ ìˆìœ¼ë©´ í•´ë‹¹ íŒŒì¼ ì„œë¹™
    # -----------------------------------------------------------------------
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # -----------------------------------------------------------------------
    # .mjs ES ëª¨ë“ˆ íŒŒì¼ (ONNX Runtimeìš©)
    # -----------------------------------------------------------------------
    location ~* \.mjs$ {
        types { application/javascript mjs; }
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin "*";
    }
    
    # -----------------------------------------------------------------------
    # ì •ì  íŒŒì¼ ìºì‹±
    # -----------------------------------------------------------------------
    # JS, CSS, ì´ë¯¸ì§€, WASM, ONNX ë“±ì€ ì¥ê¸° ìºì‹±
    # í•´ì‹œëœ íŒŒì¼ëª… ì‚¬ìš© ì‹œ ì•ˆì „í•˜ê²Œ ì¥ê¸° ìºì‹± ê°€ëŠ¥
    # -----------------------------------------------------------------------
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|wasm|onnx)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin "*";
    }
    
    # -----------------------------------------------------------------------
    # index.htmlì€ ìºì‹±í•˜ì§€ ì•ŠìŒ
    # -----------------------------------------------------------------------
    # ìƒˆ ë°°í¬ ì¦‰ì‹œ ë°˜ì˜ì„ ìœ„í•´ ìºì‹± ë¹„í™œì„±í™”
    # -----------------------------------------------------------------------
    location = /index.html {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # -----------------------------------------------------------------------
    # í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
    # -----------------------------------------------------------------------
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
