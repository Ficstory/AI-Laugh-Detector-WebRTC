# =============================================================================
# Frontend Development Configuration
# =============================================================================
#
# ğŸ“‹ ê°œìš”:
#   - Development í™˜ê²½ìš© í”„ë¡ íŠ¸ì—”ë“œ ì»¨í…Œì´ë„ˆ
#   - Vite ê°œë°œ ì„œë²„ (HMR ì§€ì›)
#   - dev-netì„ í†µí•´ ë°±ì—”ë“œ APIì™€ í†µì‹ 
#
# ğŸš€ ì‚¬ìš©ë²•:
#   docker compose -f docker-compose.dev.yml up -d
#
# âš ï¸ ì „ì œ ì¡°ê±´:
#   - dev-net ë„¤íŠ¸ì›Œí¬ê°€ ë¨¼ì € ìƒì„±ë˜ì–´ ìˆì–´ì•¼ í•¨
#   - `make data-dev-up`ìœ¼ë¡œ ë°ì´í„° ì„œë¹„ìŠ¤ ë¨¼ì € ì‹¤í–‰
#
# ğŸŒ ë„¤íŠ¸ì›Œí¬:
#   - dev-net (172.21.0.0/16) - Development ê²©ë¦¬ ë„¤íŠ¸ì›Œí¬
#
# ğŸ”§ ê°œë°œ ê¸°ëŠ¥:
#   - Hot Module Replacement (HMR) ì§€ì›
#   - ì†ŒìŠ¤ ì½”ë“œ ë³€ê²½ ì‹œ ìë™ ë¦¬ë¡œë“œ
#
# =============================================================================

services:
  # ===========================================================================
  # Development Frontend (Vite Dev Server)
  # ===========================================================================
  #
  # ì—­í• :
  #   - Vite ê°œë°œ ì„œë²„ ì‹¤í–‰
  #   - HMRë¡œ ë¹ ë¥¸ ê°œë°œ ì‚¬ì´í´
  #   - ì†ŒìŠ¤ ì½”ë“œ ë§ˆìš´íŠ¸ë¡œ ì‹¤ì‹œê°„ ë°˜ì˜
  #
  # ì ‘ê·¼ ê²½ë¡œ:
  #   - Nginx Proxyë¥¼ í†µí•´ /dev ê²½ë¡œë¡œ ì ‘ê·¼
  #   - ì˜ˆ: https://i14e207.p.ssafy.io/dev
  #
  # ===========================================================================
  dev-frontend:
    build:
      context: .
      dockerfile: Dockerfile    # Developmentìš© Dockerfile
    image: dev-frontend:latest
    container_name: dev-frontend
    restart: always
    
    # -----------------------------------------------------------------------
    # í¬íŠ¸ ì„¤ì •
    # -----------------------------------------------------------------------
    # expose: ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ë§Œ í—ˆìš© (ì™¸ë¶€ ë…¸ì¶œ X)
    # Vite ê°œë°œ ì„œë²„ëŠ” 5173 í¬íŠ¸ ì‚¬ìš©
    # -----------------------------------------------------------------------
    expose:
      - "5173"
    
    # -----------------------------------------------------------------------
    # ë³¼ë¥¨ ë§ˆìš´íŠ¸
    # -----------------------------------------------------------------------
    # ì†ŒìŠ¤ ì½”ë“œ ë§ˆìš´íŠ¸ë¡œ HMR ì§€ì›
    # node_modulesëŠ” ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²ƒ ì‚¬ìš© (ìµëª… ë³¼ë¥¨)
    # -----------------------------------------------------------------------
    # -----------------------------------------------------------------------
    # ë³¼ë¥¨ ë§ˆìš´íŠ¸ (ì œê±°ë¨)
    # -----------------------------------------------------------------------
    # CI/CD ë°°í¬ ì‹œ í˜¸ìŠ¤íŠ¸ ë³¼ë¥¨ ë§ˆìš´íŠ¸ëŠ” ì†ŒìŠ¤ ì½”ë“œ ëˆ„ë½ ì›ì¸ì´ ë¨
    # Dockerfileì˜ COPYë¥¼ í†µí•´ ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½
    # -----------------------------------------------------------------------
    # volumes:
    #   - .:/app
    #   - /app/node_modules
    
    # -----------------------------------------------------------------------
    # ë„¤íŠ¸ì›Œí¬ ì„¤ì •
    # -----------------------------------------------------------------------
    # dev-net: Development ê²©ë¦¬ ë„¤íŠ¸ì›Œí¬
    # IP ê³ ì •: Nginx upstreamì—ì„œ ì°¸ì¡°í•˜ê¸° ìœ„í•¨
    # -----------------------------------------------------------------------
    networks:
      - dev-net
    
    # -----------------------------------------------------------------------
    # í™˜ê²½ ë³€ìˆ˜
    # -----------------------------------------------------------------------
    environment:
      - NODE_ENV=development
      - VITE_API_URL=${VITE_API_URL:-/dev/api}
    
    # -----------------------------------------------------------------------
    # ë¦¬ì†ŒìŠ¤ ì œí•œ
    # -----------------------------------------------------------------------
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
    
    # -----------------------------------------------------------------------
    # í—¬ìŠ¤ì²´í¬
    # -----------------------------------------------------------------------
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:5173"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

# =============================================================================
# Networks
# =============================================================================
#
# dev-net:
#   - infra/docker-compose.data.dev.ymlì—ì„œ ìƒì„±
#   - ì—¬ê¸°ì„œëŠ” externalë¡œ ì°¸ì¡°
#   - IPAM: 172.21.0.0/16
#
# =============================================================================
networks:
  dev-net:
    external: true
