# 파인튜닝 성능 비교 실험 계획서

**작성일**: 2025-01-22
**목적**: 파인튜닝 전후 모델 성능 비교

---

## 1. 실험 목표

Baseline 모델(현재 ONNX)과 파인튜닝 모델의 성능 차이 정량적 측정

---

## 2. 평가 지표

| 지표 | 설명 | 중요도 |
|------|------|--------|
| Accuracy | 전체 정확도 | ⭐⭐⭐ |
| Precision | 웃었다고 판정한 것 중 실제 웃은 비율 (FP 체크) | ⭐⭐⭐⭐ |
| Recall | 실제 웃은 것 중 맞춘 비율 (FN 체크) | ⭐⭐⭐⭐⭐ |
| F1 Score | Precision과 Recall의 균형 | ⭐⭐⭐⭐ |
| ROC/AUC | 모든 threshold에서의 종합 성능 | ⭐⭐⭐⭐ |
| Optimal Threshold | 최적 임계값 (Youden's J Index) | ⭐⭐⭐ |

---

## 3. 데이터 수집

### 촬영 프로토콜

```
[0초]────[3초]────[6초]────[9초]
  │        │        │        │
  ▼        ▼        ▼        ▼
무표정    웃음시작   웃음끝   종료
```

**안내 메시지**:
- 0~3초: "준비하세요" (무표정 유지)
- 3~6초: "웃으세요!" (웃음)
- 6~9초: "멈추세요" (종료)

### 추출 구간

| 구간 | 라벨 | 이유 |
|------|------|------|
| 1~2초 | non-smile | 확실히 무표정 구간 |
| 4~5초 | smile | 확실히 웃는 구간 |

### 데이터 형식

- **촬영**: 30fps
- **시퀀스**: 5프레임
- **이미지 크기**: 224x224
- **텐서 shape**: (1, 5, 3, 224, 224)

### 캐글 배포용 형식

```
dataset/
├── images/
│   ├── seq_0001_frame_0.jpg
│   ├── seq_0001_frame_1.jpg
│   └── ...
├── labels.csv
└── README.md
```

---

## 4. 필요한 스크립트

### 4.1 데이터 수집 스크립트
- 웹캠 실시간 촬영
- 카운트다운 + 안내 메시지 오버레이 (크게)
- 자동 프레임 추출 (1~2초, 4~5초)
- 캐글 형식으로 저장

### 4.2 시각화 스크립트
- 5프레임 시퀀스를 이미지 그리드로 저장
- 라벨링 전수 검사용

### 4.3 평가 스크립트
- Baseline 모델 평가
- 6개 지표 계산
- ROC 커브 시각화
- 최적 threshold 자동 계산

### 4.4 파인튜닝 스크립트
- PyTorch 모델 학습
- Y자형 듀얼 헤드 구조 유지
- ONNX 변환

### 4.5 비교 리포트 스크립트
- Baseline vs Finetuned 결과 비교
- 표/그래프 자동 생성

---

## 5. 실험 순서

1. **데이터 수집 스크립트 구현**
2. **데이터 촬영** (직접 수집)
3. **시각화로 라벨 검증**
4. **Baseline 성능 측정**
5. **파인튜닝 실행**
6. **파인튜닝 모델 성능 측정**
7. **결과 비교 리포트 생성**

---

## 6. Baseline 측정 결과 (2025-01-22)

### 데이터셋
- 총 샘플: 80개 시퀀스
- Smile: 40개
- Non-smile: 40개

### 성능 지표 (threshold=0.5)

| 지표 | Baseline | Finetuned (목표) |
|------|----------|------------------|
| Accuracy | **65.00%** | 85%+ |
| Precision | **62.50%** | 85%+ |
| Recall | **75.00%** | 90%+ |
| F1 Score | **68.18%** | 87%+ |
| ROC AUC | **0.6606** | 0.90+ |

### Confusion Matrix
```
                 Predicted
                 Non-Smile  Smile
Actual Non-Smile      22      18
Actual Smile          10      30
```

### 분석
- Recall(75%)이 Precision(62.5%)보다 높음 → FP가 많음 (안 웃었는데 웃었다고 판정)
- Optimal Threshold: **0.8659** (현재 0.5 대비 높음)
- AUC 0.66 → 개선 여지 많음

### 결과 파일
- `data/evaluation/baseline_results_20260122_112534.json`
- `data/evaluation/baseline_roc_20260122_112534.png`

---

## 7. 다음 단계

- [ ] 데이터 수집 스크립트 구현
- [ ] 시각화 스크립트 구현
- [ ] 평가 스크립트 구현
- [ ] 데이터 촬영
- [ ] Baseline 측정
- [ ] 파인튜닝 실행
- [ ] 결과 비교

---

*최종 수정: 2025-01-22*
