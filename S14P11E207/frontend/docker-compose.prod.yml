# =============================================================================
# Frontend Production Configuration
# =============================================================================
#
# ğŸ“‹ ê°œìš”:
#   - Production í™˜ê²½ìš© í”„ë¡ íŠ¸ì—”ë“œ ì»¨í…Œì´ë„ˆ
#   - Nginxë¡œ ë¹Œë“œëœ ì •ì  íŒŒì¼ ì„œë¹™
#   - prod-netì„ í†µí•´ ë°±ì—”ë“œ APIì™€ í†µì‹ 
#
# ğŸš€ ì‚¬ìš©ë²•:
#   docker compose -f docker-compose.prod.yml up -d
#
# âš ï¸ ì „ì œ ì¡°ê±´:
#   - prod-net ë„¤íŠ¸ì›Œí¬ê°€ ë¨¼ì € ìƒì„±ë˜ì–´ ìˆì–´ì•¼ í•¨
#   - `make data-prod-up`ìœ¼ë¡œ ë°ì´í„° ì„œë¹„ìŠ¤ ë¨¼ì € ì‹¤í–‰
#
# ğŸŒ ë„¤íŠ¸ì›Œí¬:
#   - prod-net (172.20.0.0/16) - Production ê²©ë¦¬ ë„¤íŠ¸ì›Œí¬
#   - prod-frontend IP: 172.20.0.10
#
# =============================================================================

services:
  # ===========================================================================
  # Production Frontend (Nginx ì •ì  ì„œë¹™)
  # ===========================================================================
  #
  # ì—­í• :
  #   - React/Vue ë¹Œë“œ ê²°ê³¼ë¬¼ ì„œë¹™
  #   - SPA ë¼ìš°íŒ… ì§€ì› (try_files)
  #   - Gzip ì••ì¶•ìœ¼ë¡œ ì „ì†¡ ìµœì í™”
  #
  # ì ‘ê·¼ ê²½ë¡œ:
  #   - Nginx Proxyë¥¼ í†µí•´ / ê²½ë¡œë¡œ ì ‘ê·¼
  #   - ì˜ˆ: https://i14e207.p.ssafy.io/
  #
  # ===========================================================================
  prod-frontend:
    build:
      context: .
      dockerfile: Dockerfile.prod    # Productionìš© ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ
      args:
        - VITE_API_URL=${VITE_API_URL:-/api}
        - VITE_KAKAO_CLIENT_ID=${KAKAO_REST_API_KEY}
        - VITE_NAVER_CLIENT_ID=${NAVER_REST_API_KEY}
        - VITE_GOOGLE_CLIENT_ID=${GOOGLE_REST_API_KEY}
    image: prod-frontend:latest
    container_name: prod-frontend
    restart: always
    
    # -----------------------------------------------------------------------
    # í¬íŠ¸ ì„¤ì •
    # -----------------------------------------------------------------------
    # expose: ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ë§Œ í—ˆìš© (ì™¸ë¶€ ë…¸ì¶œ X)
    # Nginx Proxyê°€ ì´ ì»¨í…Œì´ë„ˆë¡œ í”„ë¡ì‹œí•¨
    # -----------------------------------------------------------------------
    expose:
      - "80"
    
    # -----------------------------------------------------------------------
    # ë„¤íŠ¸ì›Œí¬ ì„¤ì •
    # -----------------------------------------------------------------------
    # prod-net: Production ê²©ë¦¬ ë„¤íŠ¸ì›Œí¬
    # IP ê³ ì •: Nginx upstreamì—ì„œ ì°¸ì¡°í•˜ê¸° ìœ„í•¨
    # -----------------------------------------------------------------------
    networks:
      - prod-net
    
    # -----------------------------------------------------------------------
    # í™˜ê²½ ë³€ìˆ˜
    # -----------------------------------------------------------------------
    environment:
      - NODE_ENV=production
    
    # -----------------------------------------------------------------------
    # ë¦¬ì†ŒìŠ¤ ì œí•œ
    # -----------------------------------------------------------------------
    # NginxëŠ” ê°€ë³ì§€ë§Œ, íŠ¸ë˜í”½ ê¸‰ì¦ ëŒ€ë¹„ ì—¬ìœ  í™•ë³´
    # -----------------------------------------------------------------------
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    
    # -----------------------------------------------------------------------
    # í—¬ìŠ¤ì²´í¬
    # -----------------------------------------------------------------------
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80"]
      interval: 30s
      timeout: 10s
      retries: 3
    
    # -----------------------------------------------------------------------
    # ë¡œê¹… ì„¤ì •
    # -----------------------------------------------------------------------
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"

# =============================================================================
# Networks
# =============================================================================
#
# prod-net:
#   - infra/docker-compose.data.prod.ymlì—ì„œ ìƒì„±
#   - ì—¬ê¸°ì„œëŠ” externalë¡œ ì°¸ì¡°
#   - IPAM: 172.20.0.0/16
#
# =============================================================================
networks:
  prod-net:
    external: true
